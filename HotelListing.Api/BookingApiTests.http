### Variables
@json = application/json
@host=https://localhost:7238
@hotelId=27
@bookingId=17
@today={{$localDatetime iso8601}} 
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIzMWExMzFkOC0zMGM5LTQ5OWUtOGNhYS0xYWFjOWQ5NDA3NDUiLCJlbWFpbCI6IkFkbWluQWRtaW5AbG9jYWxob3N0LmNvbSIsImp0aSI6IjE4ZGQzNjMwLTI1ZjMtNDllNy1iM2E5LTAzYTFmM2EwNWMyZSIsIm5hbWUiOiJhZG1pbiwgYWRtaW4iLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJBZG1pbmlzdHJhdG9yIiwiZXhwIjoxNzU5ODU3NDA5LCJpc3MiOiJIb3RlbExpc3RpbmdBUEkiLCJhdWQiOiJIb3RlbExpc3RpbmdBUElDbGllbnQifQ.UFKA0IO-smHEwMeWzESmIatinSgJvjq6Csua52uo06c
###
POST {{host}}/api/auth/register
Content-Type: application/json

{
  "email": "AdminAdmin@localhost.com",
  "password": "P@ssword1",
  "firstName":"admin",
  "lastName": "admin",
  "role": "Administrator",
  "associatedHotelId": 27
}
###
POST {{host}}/api/auth/login
Content-Type: application/json


{
  "email": "AdminAdmin@localhost.com",
  "password": "P@ssword1"
}
###
POST {{host}}/api/auth/login
Content-Type: application/json

{
  "email": "user@localhost.com",
  "password": "P@ssword1"
}

###
# 1. CreateBookingDto - Happy path (3 nights)
POST {{host}}/api/hotels/{{hotelId}}/bookings
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "checkIn": "2025-10-10",
  "checkOut": "2025-10-12",
  "guests": 2
}

###
# 2. CreateBookingDto - Different hotel, single night stay
POST {{host}}/api/hotels/{{hotelId}}/bookings
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "hotelId": {{hotelId}},
  "checkIn": "2025-11-01",
  "checkOut": "2025-11-02",
  "guests": 1
}

###
# 3. CreateBookingDto - Invalid (checkOut before checkIn)
# Expect: Validation error "Check-out must be after check-in."
POST {{host}}/api/hotels/{{hotelId}}/bookings
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "hotelId": {{hotelId}},
  "checkIn": "2025-12-05",
  "checkOut": "2025-12-04",
  "guests": 2
}

###
# 4. CreateBookingDto - Invalid (guests <= 0)
# Expect: Validation error "Guests must be at least 1."
POST {{host}}/api/hotels/{{hotelId}}/bookings
Content-Type: application/json
Authorization: Bearer {{token}}
{
  "hotelId": {{hotelId}},
  "checkIn": "2025-12-10",
  "checkOut": "2025-12-12",
  "guests": 0
}

###
# 5. CreateBookingDto - Overlap test (make sure an earlier booking exists with same dates)
# Expect: Conflict "The selected dates overlap with an existing booking."
POST {{host}}/api/hotels/{{hotelId}}/bookings
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "hotelId": {{hotelId}},
  "checkIn": "2025-10-22",
  "checkOut": "2025-10-24",
  "guests": 1
}

###
# 6. UpdateBookingDto - Extend stay 
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "checkIn": "2025-10-3",
  "checkOut": "2025-10-4",
  "guests": 2
}

###
# 7. UpdateBookingDto - Shrink stay & change guests
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "checkIn": "2025-10-11",
  "checkOut": "2025-10-13",
  "guests": 4
}

###
# 8. UpdateBookingDto - Invalid (same day)
# Expect: Validation error (Check-out must be after check-in.)
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "checkIn": "2025-11-25",
  "checkOut": "2025-11-26",
  "guests": 2
}

###
# 9. UpdateBookingDto - Invalid guests
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "checkIn": "2025-11-20",
  "checkOut": "2025-11-22",
  "guests": 0
}

###
# 10. Admin confirm booking
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}/admin/confirm
Authorization: Bearer {{token}}

###
# 11. Admin cancel booking
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}/admin/cancel
Authorization: Bearer {{token}}

###
# 12. User cancel booking
PUT {{host}}/api/hotels/{{hotelId}}/bookings/{{bookingId}}/cancel
Authorization: Bearer {{token}}
###
# 13. List all bookings for hotel
GET {{host}}/api/hotels/{{hotelId}}/bookings/admin?pagesize=2&Status=Confirmed
Authorization: Bearer {{token}}

###
GET {{host}}/api/hotels/{{hotelId}}/bookings
Authorization: Bearer {{token}}

